<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Store Backend Tester</title>
<style>
body { font-family: Arial,sans-serif; margin:20px; line-height:1.6; }
h1 { color:#333; border-bottom:2px solid #eee; padding-bottom:10px; }
.forms-container { display:flex; flex-wrap:wrap; gap:30px; margin:20px 0; }
.form-box { flex:1; min-width:300px; border:1px solid #ddd; padding:20px; border-radius:5px; background:#f9f9f9; }
.form-box h2 { margin-top:0; color:#444; font-size:1.2em; border-bottom:1px solid #eee; padding-bottom:10px; }
label { display:block; margin:10px 0 5px; font-weight:bold; }
textarea { width:100%; font-family:monospace; font-size:14px; padding:8px; border:1px solid #ccc; border-radius:4px; box-sizing:border-box; }
button { background:#007bff; color:white; border:none; padding:10px 20px; border-radius:4px; cursor:pointer; font-size:16px; margin-top:10px; }
button:hover { background:#0056b3; }
#status { margin-top:20px; padding:15px; background:#f8f9fa; border:1px solid #ddd; border-radius:4px; font-family:monospace; white-space:pre-wrap; max-height:300px; overflow-y:auto; }
</style>
</head>
<body>

<h1>Store Backend Tester</h1>
<p>Test Stripe and PayPal integration</p>

<div class="forms-container">
<div class="form-box">
<h2>Test Stripe Checkout</h2>
<form id="stripeForm">
<label>Stripe Request (JSON):</label>
<textarea id="stripeRequest" rows="9">{
  "items": [
    {
      "id": "price_1StHDdD0voGcD5ZoTRCW3RrO",
      "quantity": 1
    }
  ],
  "email": "test@example.com"
}</textarea>
<button type="button" onclick="testStripe()">Test Stripe Checkout</button>
</form>
</div>

<div class="form-box">
<h2>Test PayPal Order</h2>
<form id="paypalForm">
<label>PayPal Items (JSON):</label>
<textarea id="paypalItems" rows="6">[
  {
    "priceId": "price_1StHDdD0voGcD5ZoTRCW3RrO",
    "quantity": 1
  }
]</textarea>
<button type="button" onclick="testPayPal()">Test PayPal Order</button>
</form>
</div>
</div>

<hr>
<h2>API Status</h2>
<button onclick="checkHealth()">Check API Health</button>
<div id="status"></div>

<script>
const BASE_URL = 'https://expressjs-stripe-paypal.onrender.com'; // <- update if needed

function testStripe() {
    try {
        const requestData = JSON.parse(document.getElementById('stripeRequest').value);
        fetch(BASE_URL + '/api/stripe/create-session', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify(requestData)
        })
        .then(r => r.json())
        .then(data => {
            if(data.success && data.url) window.location.href = data.url;
            else alert('Stripe Error: ' + JSON.stringify(data.error || data));
        }).catch(e=>alert('Error: '+e.message));
    } catch(e){ alert('Invalid JSON: '+e.message); }
}

function testPayPal() {
    try {
        const items = JSON.parse(document.getElementById('paypalItems').value);
        fetch(BASE_URL + '/api/paypal/create-order', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({items:items})
        })
        .then(r=>r.json())
        .then(data=>{
            if(data.id && data.links){
                const link = data.links.find(l=>l.rel==='approve');
                if(link) window.location.href = link.href;
                else alert('No PayPal approval link found');
            } else alert('PayPal Error: '+JSON.stringify(data.error || data));
        }).catch(e=>alert('Error: '+e.message));
    } catch(e){ alert('Invalid JSON: '+e.message); }
}

function checkHealth() {
    fetch(BASE_URL+'/api/health')
        .then(r=>r.json())
        .then(data=>{
            document.getElementById('status').innerHTML = '<pre>'+JSON.stringify(data,null,2)+'</pre>';
        }).catch(e=>{
            document.getElementById('status').innerHTML='Error: '+e.message;
        });
}
</script>

</body>
</html>
